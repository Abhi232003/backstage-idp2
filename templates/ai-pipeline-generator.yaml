apiVersion: scaffolder.backstage.io/v1beta3
kind: Template
metadata:
  name: ai-pipeline-generator
  title: AI Pipeline Generator
  description: Generate GitHub Actions pipelines using AI for existing repositories
  tags:
    - recommended
    - ai
    - pipeline
    - github-actions
spec:
  owner: platform-team
  type: service
  parameters:
    - title: Repository Information
      required:
        - owner
        - repo
        - userPrompt
      properties:
        owner:
          title: Repository Owner
          type: string
          description: The GitHub username or organization
          default: Abhi232003
        repo:
          title: Repository Name
          type: string
          description: The name of the repository
          default: my-test-weather-app
        userPrompt:
          title: What do you want the pipeline to do?
          type: string
          description: e.g. "Generate a GitHub Actions pipeline for Node.js with test, build, and deploy steps"
          ui:widget: textarea
          ui:placeholder: "Generate a GitHub Actions pipeline for this project"
          default: Generate a GitHub Actions pipeline for this project
  steps:
    - id: clone
      name: ğŸ“¥ Cloning Repository
      action: fetch:plain
      input:
        url: https://github.com/${{ parameters.owner }}/${{ parameters.repo }}
        targetPath: repo
    
    - id: ai-generate-pipeline
      name: ğŸ¤– Generating Pipeline with AI
      action: ai:generate-pipeline
      input:
        repoPath: repo
        userRequest: ${{ parameters.userPrompt }}
        openaiApiKey: 'HARDCODED'
        pipelineFileName: generated-pipeline.yml
        createPullRequest: true
        owner: ${{ parameters.owner }}
        repo: ${{ parameters.repo }}
    
    - id: display-results
      name: âœ… Pipeline Generated - Pull Request Created
      action: debug:log
      input:
        message: |
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘                      ğŸ‰ AI PIPELINE GENERATED SUCCESSFULLY!                 â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          ğŸ“ Repository: ${{ parameters.owner }}/${{ parameters.repo }}
          ğŸ“ File: .github/workflows/${{ steps['ai-generate-pipeline'].output.pipelineFileName }}
          ğŸ¤– Generated by: OpenAI GPT-4
          ğŸ”€ Branch: ${{ steps['ai-generate-pipeline'].output.branchName }}
          
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘                          ğŸ“‹ GENERATED PIPELINE YAML                         â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          ```yaml
          ${{ steps['ai-generate-pipeline'].output.pipelineContent }}
          ```
          
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘                              ğŸ¯ NEXT STEPS                                  â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          âœ… A Pull Request has been created with your new pipeline!
          ï¿½ Review the changes in the pull request
          ï¿½ Merge when you're ready to activate the pipeline
          
          ğŸ’¡ **Note**: The pipeline will only become active after you merge the PR

  output:
    links:
      - title: ğŸ”€ View Pull Request
        url: https://github.com/${{ parameters.owner }}/${{ parameters.repo }}/pulls
        icon: github
        description: "Review and merge the pull request with your new pipeline"
      - title: ğŸ  View Repository
        url: https://github.com/${{ parameters.owner }}/${{ parameters.repo }}
        icon: github
        description: "Navigate to your repository homepage"
      - title: âš¡ GitHub Actions
        url: https://github.com/${{ parameters.owner }}/${{ parameters.repo }}/actions
        icon: catalog
        description: "View your repository's GitHub Actions workflows"
      - title: ğŸ”„ Generate Another Pipeline
        url: /create/actions
        icon: scaffolder  
        description: "Generate another pipeline for this or a different repository"
